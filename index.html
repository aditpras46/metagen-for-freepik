<!DOCTYPE html><html lang="id" class="dark"><head>    <meta charset="UTF-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>Metagen AI: SYSTEM_OVERRIDE</title>    <!-- Load Tailwind CSS -->    <script src="https://cdn.tailwindcss.com"></script>    <!-- Load JetBrains Mono Font for Terminal look -->    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;700&display=swap" rel="stylesheet">    <!-- Load Lucide Icons -->    <script src="https://unpkg.com/lucide@latest"></script>    <script>        tailwind.config = {            darkMode: 'class',            theme: {                extend: {                    colors: {                        cyber: {                            black: '#020202',                            dark: '#051a05',                            dim: '#0a2e0a',                            primary: '#00ff41', // Matrix Green                            bright: '#ccffcc',                            alert: '#ff003c',                            warning: '#ffff00'                        }                    },                    fontFamily: {                        mono: ['"JetBrains Mono"', 'monospace'],                    }                }            }        }    </script>    <style>        body {            font-family: 'JetBrains Mono', monospace;            background-color: #000000;            background-image:                 linear-gradient(rgba(0, 255, 65, 0.03) 1px, transparent 1px),                linear-gradient(90deg, rgba(0, 255, 65, 0.03) 1px, transparent 1px);            background-size: 30px 30px;            color: #00ff41;            overflow-x: hidden;        }        /* CRT Scanline Effect */        body::before {            content: " ";            display: block;            position: fixed;            top: 0;            left: 0;            bottom: 0;            right: 0;            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));            z-index: 50;            background-size: 100% 2px, 3px 100%;            pointer-events: none;        }        /* Cyber Panel */        .cyber-panel {            background: rgba(5, 15, 5, 0.85);            border: 1px solid #00ff41;            box-shadow: 0 0 10px rgba(0, 255, 65, 0.1);            position: relative;        }        .cyber-panel::after {            content: '';            position: absolute;            top: -1px;            left: -1px;            width: 10px;            height: 10px;            border-top: 2px solid #00ff41;            border-left: 2px solid #00ff41;        }        .cyber-panel::before {            content: '';            position: absolute;            bottom: -1px;            right: -1px;            width: 10px;            height: 10px;            border-bottom: 2px solid #00ff41;            border-right: 2px solid #00ff41;        }        /* Terminal Input */        .cyber-input {            background: #000000;            border: 1px solid #0a4f0a;            color: #00ff41;            font-family: 'JetBrains Mono', monospace;            transition: all 0.2s ease;        }        .cyber-input:focus {            border-color: #00ff41;            box-shadow: 0 0 15px rgba(0, 255, 65, 0.3);            outline: none;            background: #051a05;        }                select.cyber-input option {            background-color: #000000;            color: #00ff41;        }        /* Scrollbar */        ::-webkit-scrollbar {            width: 10px;            height: 10px;        }        ::-webkit-scrollbar-track {            background: #020202;            border-left: 1px solid #0a2e0a;        }        ::-webkit-scrollbar-thumb {            background: #0a4f0a;            border: 1px solid #00ff41;        }        ::-webkit-scrollbar-thumb:hover {            background: #00ff41;        }        /* Glitch Animation for Text */        @keyframes glitch {            0% { text-shadow: 2px 0 #ff003c, -2px 0 #00ff41; }            25% { text-shadow: -2px 0 #ff003c, 2px 0 #00ff41; }            50% { text-shadow: 2px 0 #ff003c, -2px 0 #00ff41; }            75% { text-shadow: -2px 0 #ff003c, 2px 0 #00ff41; }            100% { text-shadow: 2px 0 #ff003c, -2px 0 #00ff41; }        }        .glitch-hover:hover {            animation: glitch 0.3s infinite;        }        /* Buttons */        .btn-cyber-primary {            background: #000000;            border: 1px solid #00ff41;            color: #00ff41;            text-transform: uppercase;            letter-spacing: 1px;            position: relative;            overflow: hidden;            transition: all 0.3s;        }        .btn-cyber-primary:hover:not(:disabled) {            background: #00ff41;            color: #000000;            box-shadow: 0 0 20px rgba(0, 255, 65, 0.6);        }        .btn-cyber-primary:disabled {            border-color: #0a4f0a;            color: #0a4f0a;            cursor: not-allowed;        }        /* Success Button */        .btn-cyber-success {            background: #001100;            border: 1px solid #00cc33;            color: #ccffcc;        }        .btn-cyber-success:hover:not(:disabled) {            background: #00cc33;            color: #000000;            box-shadow: 0 0 15px rgba(0, 204, 51, 0.5);        }        /* Loading Animation */        .cyber-loader {            border: 2px solid #0a2e0a;            border-top: 2px solid #00ff41;            border-radius: 50%;            width: 40px;            height: 40px;            animation: spin 1s linear infinite;        }        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }                /* Table Styles */        .cyber-table-head {            background: #051a05;            border-bottom: 2px solid #00ff41;        }        .cyber-table-row:hover {            background: rgba(0, 255, 65, 0.05);        }                textarea {            border-radius: 0 !important;        }                /* Selection */        ::selection {            background: #00ff41;            color: #000;        }        .typing-cursor::after {            content: '¦';            animation: blink 1s step-end infinite;            margin-left: 2px;            color: #00ff41;        }        @keyframes blink { 50% { opacity: 0; } }    </style></head><body class="p-4 sm:p-6 min-h-screen flex flex-col items-center font-mono">    <!-- Decorative background elements -->    <div class="fixed top-0 left-0 w-full h-full overflow-hidden -z-10 pointer-events-none">        <div class="absolute top-10 left-10 text-cyber-dim opacity-20 text-xs">            01001011 01010101<br>            00110100 01011010        </div>        <div class="absolute bottom-10 right-10 text-cyber-dim opacity-20 text-xs text-right">            SYSTEM_READY<br>            INIT_PROTOCOL_V3        </div>    </div>    <!-- Main Container -->    <div id="app" class="w-full max-w-[95rem] cyber-panel p-6 lg:p-8 relative transition-all duration-500 ease-in-out mt-8 mb-8 z-10">                <!-- Header -->        <header class="mb-8 flex flex-col md:flex-row md:items-center justify-between border-b border-cyber-dim pb-6">            <div>                <h1 class="text-3xl md:text-4xl font-bold tracking-tighter flex items-center text-cyber-primary">                    <div class="p-2 border border-cyber-primary bg-black mr-3">                        <i data-lucide="terminal" class="w-8 h-8"></i>                    </div>                    <span class="glitch-hover cursor-default">METAGEN_AI_PRO</span>                </h1>                <p class="text-cyber-primary/70 mt-2 text-sm md:text-base font-mono ml-1 typing-cursor">> Menginisialisasi Generator Metadata Stok Foto...</p>            </div>            <div class="mt-4 md:mt-0 flex gap-2 items-center">                <div class="px-3 py-1 bg-black border border-cyber-primary text-xs text-cyber-primary font-mono shadow-[0_0_5px_rgba(0,255,65,0.3)]">v3.1.0_UNLOCKED</div>            </div>        </header>        <!-- Image Upload and Action Panel -->        <section class="mb-8 grid grid-cols-1 lg:grid-cols-4 gap-6">            <!-- Upload Area -->            <div class="lg:col-span-3">                <input type="file" id="imageUpload" multiple accept="image/*" class="hidden" onchange="handleFileSelect(this.files)">                                <label for="imageUpload" id="uploadLabel" class="group relative flex flex-col items-center justify-center h-48 md:h-56 w-full border border-dashed border-cyber-dim hover:border-cyber-primary bg-black/50 hover:bg-cyber-dim/20 transition-all duration-300 cursor-pointer overflow-hidden">                    <div class="absolute inset-0 bg-cyber-primary/5 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>                                        <div class="z-10 flex flex-col items-center transform group-hover:scale-105 transition-transform duration-300">                        <div class="p-4 bg-black border border-cyber-dim group-hover:border-cyber-primary shadow-[0_0_10px_rgba(0,255,65,0.1)] mb-4 transition-all">                            <i data-lucide="binary" class="w-8 h-8 text-cyber-primary/70 group-hover:text-cyber-primary transition-colors"></i>                        </div>                        <p id="uploadText" class="text-lg font-bold text-cyber-primary group-hover:text-cyber-bright transition-colors uppercase tracking-widest">                            [ UPLOAD_TARGETS ]                        </p>                        <p class="text-xs text-cyber-primary/50 mt-2 font-mono">                            JPEG/PNG DETECTED // MAX_CAPACITY: 100                        </p>                    </div>                </label>            </div>            <!-- Action Area -->            <div class="lg:col-span-1 flex flex-col gap-4">                <div class="cyber-panel p-5 flex-grow flex flex-col justify-center items-center text-center bg-black/40">                    <div id="fileStatusIcon" class="mb-3 text-cyber-dim">                        <i data-lucide="hard-drive" class="w-10 h-10"></i>                    </div>                    <p id="fileCountMessage" class="text-sm font-bold text-cyber-primary/50 mb-1">NO_DATA_STREAM</p>                    <p class="text-xs text-cyber-primary/30">Menunggu input...</p>                </div>                <button id="generateButton" onclick="generateMetadata()" disabled                        class="w-full py-4 btn-cyber-primary font-bold shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:shadow-none flex items-center justify-center group">                    <span class="flex items-center">                        <i data-lucide="cpu" class="w-5 h-5 mr-2 group-hover:animate-pulse"></i>                        EXECUTE_AI_PROTOCOL                    </span>                </button>            </div>        </section>        <!-- Result Display and Export -->        <section class="animate-fade-in">            <div class="flex flex-col lg:flex-row justify-between items-end lg:items-center mb-5 gap-4">                <h2 class="text-xl font-bold text-cyber-primary flex items-center uppercase tracking-widest border-l-4 border-cyber-primary pl-3">                    <i data-lucide="database" class="w-5 h-5 mr-3"></i>                     OUTPUT_LOG                    <span id="resultCountBadge" class="ml-3 px-2 py-0.5 bg-cyber-primary text-black text-xs font-bold hidden">0</span>                </h2>                                <div class="flex flex-col sm:flex-row gap-3 w-full lg:w-auto items-end">                    <!-- Model Selection -->                    <div class="w-full sm:w-64">                        <label for="aiModelSelect" class="block text-xs font-bold text-cyber-primary/70 mb-1 uppercase">Select_Algorithm</label>                        <select id="aiModelSelect" class="cyber-input w-full p-2.5 text-sm cursor-pointer rounded-none">                            <option value="">[ NULL ]</option>                            <option value="DALL-E 3">DALL-E_3</option>                            <option value="Midjourney">MIDJOURNEY_V6</option>                            <option value="Stable Diffusion">STABLE_DIFFUSION</option>                            <option value="Stable Diffusion XL">SDXL_TURBO</option>                            <option value="Adobe Firefly">ADOBE_FIREFLY</option>                            <option value="Leonardo.ai">LEONARDO_AI</option>                        </select>                    </div>                    <button id="exportButton" onclick="exportCSV()" disabled                            class="px-5 py-2.5 btn-cyber-success font-bold shadow-md disabled:opacity-50 disabled:grayscale disabled:cursor-not-allowed flex items-center text-sm transition-all h-[42px] whitespace-nowrap w-full sm:w-auto justify-center rounded-none uppercase tracking-wider">                        <i data-lucide="download-cloud" class="w-4 h-4 mr-2"></i> EXPORT_CSV                    </button>                </div>            </div>            <div id="loadingIndicator" class="hidden my-8">                <div class="flex flex-col items-center justify-center p-8 border border-cyber-primary/30 bg-black/50 relative overflow-hidden">                    <div class="absolute inset-0 bg-cyber-primary/5 animate-pulse"></div>                    <div class="cyber-loader mb-4"></div>                    <h3 class="text-lg font-bold text-cyber-primary animate-pulse">PROCESSING_NEURAL_NET...</h3>                    <p class="text-cyber-primary/60 text-xs mt-1 font-mono text-center max-w-md">Decoding visual patterns // Extracting semantic data...</p>                </div>            </div>            <!-- Error/Status Message Box -->            <div id="messageBox" class="mb-4 p-4 text-sm hidden border-l-4 backdrop-blur-sm shadow-sm flex items-start font-mono" role="alert">                <div id="messageIcon" class="mr-3 mt-0.5 flex-shrink-0"></div>                <div id="messageContent"></div>            </div>                        <div id="resultsContainer" class="border border-cyber-dim bg-black overflow-hidden shadow-[inset_0_0_20px_rgba(0,0,0,0.8)] flex flex-col h-[600px] relative">                <!-- Grid overlay inside table -->                <div class="absolute inset-0 bg-[linear-gradient(rgba(0,255,65,0.02)_1px,transparent_1px),linear-gradient(90deg,rgba(0,255,65,0.02)_1px,transparent_1px)] bg-[size:20px_20px] pointer-events-none"></div>                                <div class="overflow-auto custom-scrollbar flex-grow z-10">                    <table id="metadataTable" class="min-w-full divide-y divide-cyber-dim">                        <thead class="cyber-table-head sticky top-0 z-20">                            <tr>                                <th class="px-4 py-3 text-left text-xs font-bold text-cyber-primary uppercase tracking-widest w-12 border-r border-cyber-dim">ID</th>                                <th class="px-6 py-3 text-left text-xs font-bold text-cyber-primary uppercase tracking-widest w-24 border-r border-cyber-dim">VISUAL</th>                                <th class="px-6 py-3 text-left text-xs font-bold text-cyber-primary uppercase tracking-widest w-1/5 border-r border-cyber-dim">TITLE_STRING</th>                                <th class="px-6 py-3 text-left text-xs font-bold text-cyber-primary uppercase tracking-widest w-1/4 border-r border-cyber-dim">DESC_DATA</th>                                <th class="px-6 py-3 text-left text-xs font-bold text-cyber-primary uppercase tracking-widest w-1/4 border-r border-cyber-dim">KEYWORDS_ARRAY</th>                                <th class="px-6 py-3 text-left text-xs font-bold text-cyber-alert uppercase tracking-widest w-1/5">PROMPT_INPUT</th>                            </tr>                        </thead>                        <tbody id="metadataTableBody" class="divide-y divide-cyber-dim">                            <!-- Empty State -->                            <tr>                                <td colspan="6" class="p-12 text-center">                                    <div class="flex flex-col items-center justify-center text-cyber-primary/30">                                        <i data-lucide="monitor-off" class="w-16 h-16 mb-4"></i>                                        <p class="text-xl font-bold tracking-widest">SYSTEM_IDLE</p>                                        <p class="text-sm font-mono mt-2">Waiting for visual data input...</p>                                    </div>                                </td>                            </tr>                        </tbody>                    </table>                </div>            </div>        </section>                <!-- Footer -->        <div class="mt-8 text-center text-xs text-cyber-primary/40 font-mono border-t border-cyber-dim/30 pt-4 w-full">             Running on GOOGLE_GEMINI_V2.0_FLASH // SYSTEM_TIME: <span id="clock"></span>        </div>    </div>    <!-- Core Application Logic -->    <script>        // --- Global State ---        let selectedFiles = [];        let processedImagesData = [];        const GEMINI_MODEL = "gemini-2.5-flash-preview-09-2025";                // --- API KEY CONFIGURATION ---        // WARNING: Hardcoded keys in client-side code are visible to anyone inspecting the page source.        const API_KEY = "AIzaSyC5EpEgYA9oovtRdIgkF3eZkUpGb4N-Ur8";        // --- Utility Functions ---                function getBase64(file) {            return new Promise((resolve, reject) => {                const reader = new FileReader();                reader.readAsDataURL(file);                reader.onload = () => {                    // Remove "data:image/jpeg;base64," prefix                    const base64String = reader.result.split(',')[1];                    resolve(base64String);                };                reader.onerror = error => reject(error);            });        }        async function generateContent(payload, maxRetries = 3, delay = 2000) {            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL}:generateContent?key=${API_KEY}`;            for (let i = 0; i < maxRetries; i++) {                try {                    const response = await fetch(apiUrl, {                        method: 'POST',                        headers: { 'Content-Type': 'application/json' },                        body: JSON.stringify(payload)                    });                    if (response.ok) {                        const result = await response.json();                        if (result.candidates && result.candidates.length > 0) {                            return result;                        } else {                             throw new Error("API returned no candidates.");                        }                    } else if (response.status === 429) {                        // Rate limit - wait longer                        console.warn("Rate limit hit, retrying...");                        if (i < maxRetries - 1) {                            await new Promise(resolve => setTimeout(resolve, delay * 2));                             delay *= 2;                             continue;                        } else {                            throw new Error(`Exceeded maximum retries (429).`);                        }                    } else {                        const errorBody = await response.json();                        throw new Error(`API failed: ${errorBody.error?.message || response.status}`);                    }                } catch (error) {                    if (i < maxRetries - 1) {                        await new Promise(resolve => setTimeout(resolve, delay));                        delay *= 2;                    } else {                        throw error;                    }                }            }        }        function showMessage(message, type) {            const box = document.getElementById('messageBox');            const content = document.getElementById('messageContent');            const icon = document.getElementById('messageIcon');                        content.textContent = `>> ${message}`;                        // Reset base classes            box.className = 'mb-4 p-4 text-sm border-l-4 backdrop-blur-sm shadow-sm flex items-start font-mono transition-all duration-300';                        if (type === 'error') {                box.classList.add('bg-red-900/20', 'text-red-400', 'border-red-500');                icon.innerHTML = '<i data-lucide="alert-triangle" class="w-5 h-5 text-red-500"></i>';            } else if (type === 'success') {                box.classList.add('bg-green-900/20', 'text-green-400', 'border-green-500');                icon.innerHTML = '<i data-lucide="check-square" class="w-5 h-5 text-green-500"></i>';            } else {                box.classList.add('bg-blue-900/20', 'text-blue-400', 'border-blue-500');                icon.innerHTML = '<i data-lucide="info" class="w-5 h-5 text-blue-500"></i>';            }                        box.classList.remove('hidden');            lucide.createIcons();        }        // --- UI Handlers ---        function handleFileSelect(files) {            selectedFiles = Array.from(files).slice(0, 100);                        const fileStatusIcon = document.getElementById('fileStatusIcon');            const fileCountMessage = document.getElementById('fileCountMessage');            const generateButton = document.getElementById('generateButton');            const uploadLabel = document.getElementById('uploadLabel');            const resultCountBadge = document.getElementById('resultCountBadge');                        if (selectedFiles.length > 0) {                document.getElementById('uploadText').innerHTML = `<span class="text-white bg-cyber-primary px-2 text-black mr-2">${selectedFiles.length}</span> FILES_LOCKED`;                                fileCountMessage.textContent = `${selectedFiles.length} UNIT(S) READY FOR ANALYSIS`;                fileCountMessage.classList.replace('text-cyber-primary/50', 'text-cyber-primary');                                fileStatusIcon.innerHTML = `<i data-lucide="check-circle" class="w-10 h-10 text-cyber-primary animate-pulse"></i>`;                lucide.createIcons();                                generateButton.disabled = false;                document.getElementById('exportButton').disabled = true;                                processedImagesData = [];                 renderTable();                                resultCountBadge.textContent = selectedFiles.length;                resultCountBadge.classList.remove('hidden');                                // Active state for upload box                uploadLabel.classList.add('border-cyber-primary', 'bg-cyber-dim/20');                uploadLabel.classList.remove('border-cyber-dim', 'bg-black/50');            } else {                document.getElementById('uploadText').textContent = '[ UPLOAD_TARGETS ]';                fileCountMessage.textContent = 'NO_DATA_STREAM';                fileCountMessage.classList.replace('text-cyber-primary', 'text-cyber-primary/50');                                fileStatusIcon.innerHTML = `<i data-lucide="hard-drive" class="w-10 h-10"></i>`;                lucide.createIcons();                                generateButton.disabled = true;                resultCountBadge.classList.add('hidden');                                // Reset upload box                uploadLabel.classList.remove('border-cyber-primary', 'bg-cyber-dim/20');                uploadLabel.classList.add('border-cyber-dim', 'bg-black/50');            }            document.getElementById('messageBox').classList.add('hidden');        }        function renderTable() {            const tableBody = document.getElementById('metadataTableBody');            tableBody.innerHTML = '';                        if (selectedFiles.length === 0 && processedImagesData.length === 0) {                 tableBody.innerHTML = `<tr><td colspan="6" class="p-12 text-center"><div class="flex flex-col items-center justify-center text-cyber-primary/30"><i data-lucide="monitor-off" class="w-16 h-16 mb-4"></i><p class="text-xl font-bold tracking-widest">SYSTEM_IDLE</p><p class="text-sm font-mono mt-2">Waiting for visual data input...</p></div></td></tr>`;                 lucide.createIcons();                 document.getElementById('exportButton').disabled = true;                 return;            }                        let dataToRender = processedImagesData.length > 0 ? processedImagesData : selectedFiles.map( (file, index) => ({                id: index,                fileName: file.name,                status: 'pending',                imagePreviewUrl: URL.createObjectURL(file),                title: '', description: '', keywords: [], prompt: '', error: null            }));            dataToRender.forEach((data, index) => {                const isProcessing = data.status === 'processing';                const isError = data.status === 'error';                const row = document.createElement('tr');                                row.className = 'cyber-table-row border-b border-cyber-dim/30 transition-colors';                if(isError) row.classList.add('bg-red-900/10');                                let titleContent, descriptionContent, keywordsContent, promptContent;                if (isProcessing) {                    titleContent = '<div class="h-4 bg-cyber-primary/20 animate-pulse w-3/4 my-2"></div>';                    descriptionContent = '<div class="h-12 bg-cyber-primary/10 animate-pulse w-full my-2"></div>';                    keywordsContent = '<div class="h-12 bg-cyber-primary/10 animate-pulse w-full my-2"></div>';                    promptContent = '<div class="h-12 bg-cyber-primary/10 animate-pulse w-full my-2"></div>';                } else if (isError) {                    const errorMessage = data.error || 'FAILED';                    titleContent = `<span class="flex items-center text-red-500 font-bold text-xs font-mono"><i data-lucide="x-octagon" class="w-4 h-4 mr-1"></i> ERR: ${errorMessage}</span>`;                    descriptionContent = '<span class="text-red-900">NULL</span>';                    keywordsContent = '<span class="text-red-900">NULL</span>';                    promptContent = '<span class="text-red-900">NULL</span>';                } else if (data.title || data.status === 'pending') {                    const isPending = data.status === 'pending';                    const titleVal = data.title || '';                    const descVal = data.description || '';                    const keywordsVal = data.keywords.join(', ');                    const promptVal = data.prompt || '';                    if(isPending) {                        titleContent = '<span class="text-cyber-dim italic text-xs">Awaiting_cycles...</span>';                        descriptionContent = '<span class="text-cyber-dim italic text-xs">...</span>';                        keywordsContent = '<span class="text-cyber-dim italic text-xs">...</span>';                        promptContent = `<textarea rows="4" placeholder="> Input prompt override..." class="cyber-input w-full p-2 text-xs font-mono border-cyber-dim/50">${promptVal}</textarea>`;                     } else {                        titleContent = `<textarea rows="2" class="cyber-input w-full p-2 text-sm font-bold text-cyber-primary bg-black border-none resize-y">${titleVal}</textarea>`;                        descriptionContent = `<textarea rows="4" class="cyber-input w-full p-2 text-xs text-cyber-primary/80 bg-black border-none resize-y">${descVal}</textarea>`;                        keywordsContent = `<textarea rows="4" class="cyber-input w-full p-2 text-[10px] text-cyber-primary/60 font-mono bg-black border-none resize-y leading-tight">${keywordsVal}</textarea>`;                        promptContent = `<textarea rows="4" placeholder="> Input prompt..." class="cyber-input w-full p-2 text-xs text-cyber-alert border-cyber-alert/30 focus:border-cyber-alert">${promptVal}</textarea>`;                    }                }                row.innerHTML = `                    <td class="px-4 py-4 whitespace-nowrap text-xs font-mono text-cyber-dim border-r border-cyber-dim/30">#${String(index + 1).padStart(3, '0')}</td>                    <td class="px-6 py-4 border-r border-cyber-dim/30">                        <div class="relative group w-20 h-20 border border-cyber-primary/50 p-1 bg-black">                            <img src="${data.imagePreviewUrl}" alt="${data.fileName}" class="w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all" onerror="this.onerror=null;this.src='https://placehold.co/80x80/000000/00ff41?text=ERR';">                            <div class="absolute inset-0 bg-cyber-primary/10 opacity-0 group-hover:opacity-100 pointer-events-none"></div>                        </div>                        <div class="text-[9px] text-cyber-primary/50 mt-1 truncate w-20 font-mono">${data.fileName}</div>                    </td>                    <td class="px-6 py-4 align-top border-r border-cyber-dim/30">${titleContent}</td>                    <td class="px-6 py-4 align-top border-r border-cyber-dim/30">${descriptionContent}</td>                    <td class="px-6 py-4 align-top border-r border-cyber-dim/30">${keywordsContent}</td>                    <td class="px-6 py-4 align-top">${promptContent}</td>                `;                tableBody.appendChild(row);                // Re-initialize icons for new rows                lucide.createIcons();                // Listeners                const titleTextarea = row.querySelector('td:nth-child(3) textarea');                const descriptionTextarea = row.querySelector('td:nth-child(4) textarea');                const keywordsTextarea = row.querySelector('td:nth-child(5) textarea');                const promptTextarea = row.querySelector('td:nth-child(6) textarea');                if (titleTextarea) titleTextarea.addEventListener('change', (e) => data.title = e.target.value);                if (descriptionTextarea) descriptionTextarea.addEventListener('change', (e) => data.description = e.target.value);                if (keywordsTextarea) keywordsTextarea.addEventListener('change', (e) => data.keywords = e.target.value.split(',').map(k => k.trim()).filter(k => k.length > 0));                if (promptTextarea) promptTextarea.addEventListener('change', (e) => data.prompt = e.target.value);            });                        const readyCount = processedImagesData.filter(d => d.status === 'complete').length;            document.getElementById('exportButton').disabled = readyCount === 0;                        // Update badge for completed            if (readyCount > 0) {                 const badge = document.getElementById('resultCountBadge');                 badge.innerHTML = `${readyCount}/${processedImagesData.length}`;                 badge.classList.remove('hidden');            }        }        async function generateMetadata() {            if (selectedFiles.length === 0) {                showMessage("INPUT_REQUIRED: Upload at least one visual unit.", 'error');                return;            }            document.getElementById('generateButton').disabled = true;            document.getElementById('exportButton').disabled = true;            document.getElementById('loadingIndicator').classList.remove('hidden');            document.getElementById('resultsContainer').classList.add('opacity-50');             document.getElementById('messageBox').classList.add('hidden');                        document.getElementById('resultsContainer').scrollIntoView({ behavior: 'smooth', block: 'start' });            processedImagesData = selectedFiles.map((file, index) => ({                id: index,                fileName: file.name,                fileType: file.type,                fileObject: file,                imagePreviewUrl: URL.createObjectURL(file),                status: 'pending',                title: '', description: '', keywords: [], prompt: '', error: null            }));            renderTable();            let successCount = 0;            let errorCount = 0;            for (let i = 0; i < processedImagesData.length; i++) {                const dataItem = processedImagesData[i];                dataItem.status = 'processing';                renderTable();                                 try {                    // Get base64 safely                    const base64Data = await getBase64(dataItem.fileObject);                    const systemInstruction = "Act as a specialized AI metadata generator for premium stock photography agencies like Adobe Stock. Your goal is to generate high-quality, commercially relevant metadata. You must provide a Title (short, punchy, in English), a Description (detailed, describing content, mood, and usage, in English), and a list of at least 35 Keywords (mix of conceptual, technical, and descriptive terms, comma-separated in English, no duplicates). The output MUST be a single valid JSON object.";                                        const payload = {                        contents: [{                            parts: [                                { text: "Analyze the provided image and generate the required stock metadata in the specified JSON format. Ensure keywords are rich and diverse (min 35). Output ONLY pure JSON." },                                { inlineData: { mimeType: dataItem.fileType, data: base64Data } }                            ]                        }],                        systemInstruction: { parts: [{ text: systemInstruction }] },                        generationConfig: {                            responseMimeType: "application/json",                            responseSchema: {                                type: "OBJECT",                                properties: {                                    "title": { "type": "STRING" },                                    "description": { "type": "STRING" },                                    "keywords": { "type": "ARRAY", "items": { "type": "STRING" } }                                }                            }                        }                    };                    const apiResponse = await generateContent(payload);                    let jsonText = apiResponse.candidates?.[0]?.content?.parts?.[0]?.text;                                        if (!jsonText) throw new Error("Empty response stream.");                    // Robust JSON Cleanup                    jsonText = jsonText.trim();                    // Remove markdown blocks                    jsonText = jsonText.replace(/^```json\s*/i, '').replace(/\s*```$/, '');                    // Extract only the object if there's extra chatter                    const firstBrace = jsonText.indexOf('{');                    const lastBrace = jsonText.lastIndexOf('}');                    if (firstBrace !== -1 && lastBrace !== -1) {                        jsonText = jsonText.substring(firstBrace, lastBrace + 1);                    }                    let parsedJson;                    try {                        parsedJson = JSON.parse(jsonText);                    } catch (e) {                         console.error("Parse Error", e);                         console.log("Raw Text:", jsonText); // Debugging aid                         throw new Error("Invalid JSON structure.");                    }                                        if (parsedJson && parsedJson.title && parsedJson.description && Array.isArray(parsedJson.keywords)) {                        dataItem.title = parsedJson.title;                        dataItem.description = parsedJson.description;                        dataItem.keywords = parsedJson.keywords;                        dataItem.status = 'complete';                        successCount++;                    } else {                        throw new Error("Incomplete data set.");                    }                } catch (error) {                    console.error(`Processing error for ${dataItem.fileName}:`, error);                    dataItem.status = 'error';                                        if (error.message.includes('API')) {                         dataItem.error = 'CONNECTION_LOST';                    } else if (error.message.includes('JSON')) {                         dataItem.error = 'DATA_CORRUPT';                    } else {                         dataItem.error = 'PROCESS_FAILED';                    }                    errorCount++;                }                                // Add delay to prevent rate limiting (1.5 seconds)                await new Promise(resolve => setTimeout(resolve, 1500));                                renderTable();            }            document.getElementById('loadingIndicator').classList.add('hidden');            document.getElementById('resultsContainer').classList.remove('opacity-50');            document.getElementById('generateButton').disabled = false;                        if (successCount > 0) {                showMessage(`OPERATION COMPLETE: ${successCount} processed. ${errorCount > 0 ? `(${errorCount} failed)` : ''}`, 'success');                const readyCount = processedImagesData.filter(d => d.status === 'complete').length;                document.getElementById('exportButton').disabled = readyCount === 0;            } else if (errorCount > 0) {                showMessage(`SYSTEM FAILURE: ${errorCount} errors detected. Check console logs.`, 'error');            }        }        function exportCSV() {            if (processedImagesData.length === 0) {                showMessage("EXPORT_ERROR: No data resident in memory.", 'info');                return;            }            const modelSelect = document.getElementById('aiModelSelect');            const selectedModel = modelSelect.value || "UNKNOWN_MODEL";            const header = ["Filename", "Title", "Keywords", "Prompt", "Model"];                        const tableBody = document.getElementById('metadataTableBody');            const exportedData = [];            const rows = tableBody.querySelectorAll('tr');            processedImagesData.forEach((item, index) => {                if (item.status === 'complete') {                    const row = rows[index];                    if (!row) return;                                        const titleArea = row.querySelector('td:nth-child(3) textarea');                    const keywordsArea = row.querySelector('td:nth-child(5) textarea');                    const promptArea = row.querySelector('td:nth-child(6) textarea');                    const currentTitle = titleArea ? titleArea.value : item.title;                    const currentKeywordsString = keywordsArea ? keywordsArea.value : item.keywords.join(', ');                    const currentPrompt = promptArea ? promptArea.value : item.prompt;                    const escapeCSV = (str) => {                        if (!str) return "";                        let val = str.toString().replace(/"/g, '""');                        if (val.includes(";") || val.includes("\n") || val.includes("\"")) {                            val = `"${val}"`;                        }                        return val;                    };                    if (currentTitle) {                         exportedData.push([                            escapeCSV(item.fileName),                            escapeCSV(currentTitle),                             escapeCSV(currentKeywordsString),                             escapeCSV(currentPrompt),                            escapeCSV(selectedModel)                        ]);                    }                }            });            if (exportedData.length === 0) {                showMessage("EXPORT_ABORTED: No valid records found.", 'info');                return;            }            const csvContent = [                header.join(";"),                ...exportedData.map(row => row.join(";"))            ].join("\n");            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });            const url = URL.createObjectURL(blob);            const link = document.createElement('a');            link.setAttribute('href', url);            link.setAttribute('download', `DATA_DUMP_${new Date().getTime()}.csv`);            document.body.appendChild(link);            link.click();            document.body.removeChild(link);                        showMessage(`DATA DUMP SUCCESSFUL: ${exportedData.length} records written to disk.`, 'success');        }        window.onload = () => {             lucide.createIcons();             renderTable();             // Simple clock for footer            setInterval(() => {                const now = new Date();                const timeElement = document.getElementById('clock');                if(timeElement) timeElement.innerText = now.toISOString();            }, 1000);        };        window.handleFileSelect = handleFileSelect;        window.generateMetadata = generateMetadata;        window.exportCSV = exportCSV;    </script></body></html>